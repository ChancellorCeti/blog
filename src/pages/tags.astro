---
import Header from "../components/header.svelte";
import Layout from "./layouts/Layout.astro";

const tags = [
  "project euler",
  "math",
  "physics",
  "film reviews",
  "book reviews",
  "personal rambling",
    "electrodynamics"
];

const allPosts = await Astro.glob("../pages/posts/*.md");

const posts = allPosts.map((post) => ({
  title: post.frontmatter.title,
  description: post.frontmatter.description,
  pubDate: post.frontmatter.pubDate,
  url: post.url,
  tags: post.frontmatter.tags,
  date: new Date(post.frontmatter.pubDate),
}))
.sort((a, b) => b.date - a.date);;

---

<Layout>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/blogicon.png" />
    <meta name="viewport" content="width=device-width" />
    <title>Tags | Chancellor Ceti</title>
    <link rel="stylesheet" href="/tags.css" />
    <meta name="generator" content={Astro.generator} />
  </head>

  <body>
   <Header />
            <div id="tags-container">
    <h1 id="title">Blog posts</h1>
                <h1 id="subtitle">Filter posts by selecting tags</h1>
                <h2>Press "AND/OR" button to toggle selection behavior. AND will show posts with all the selected tags, while OR shows posts with at least one of the selected tags.</h2>
                <div id="logic-toggle-div">
                    <button id="logic-toggle" class="tag-btn">Mode: OR</button>
                </div>
    <div id="tag-buttons">
      {tags.map((tag) => (
        <button class="tag-btn" data-tag={tag}>{tag}</button>
      ))}
    </div>

    <div id="results"></div>
            </div>
    <script define:vars={{ posts }}>
      const selectedTags = new Set();
      let useAndLogic = false;

      const buttons = document.querySelectorAll(".tag-btn");
      const results = document.getElementById("results");
      const logicToggle = document.getElementById("logic-toggle");

      function render() {
        results.innerHTML = "";

        if (selectedTags.size === 0) return;

        const matches = posts.filter((post) => {
          const tagList = [...selectedTags];
          return useAndLogic
            ? tagList.every((tag) => post.tags.includes(tag))
            : tagList.some((tag) => post.tags.includes(tag));
        });
          matches.forEach((post) => {
  const relevantTags = post.tags.filter((t) =>
    selectedTags.has(t)
  );

  const div = document.createElement("div");
  div.className = "post";

  const formattedDate = post.pubDate
    ? new Date(post.pubDate).toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric",
      })
    : "";

  div.innerHTML = `
    <a href="${post.url}">
      <h3>${post.title}</h3>
    </a>

    ${formattedDate ? `<div class="post-date">${formattedDate}</div>` : ""}

    ${post.description ? `<p class="post-description">${post.description}</p>` : ""}

    <div class="post-tags">${post.tags.join(", ")}</div>
  `;

  results.appendChild(div);
});


        }

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const tag = btn.dataset.tag;
          btn.classList.toggle("active");

          if (selectedTags.has(tag)) {
            selectedTags.delete(tag);
          } else {
            selectedTags.add(tag);
          }

          render();
        });
      });

      logicToggle.addEventListener("click", () => {
        useAndLogic = !useAndLogic;
        logicToggle.textContent = useAndLogic ? "Mode: AND" : "Mode: OR";
        render();
      });
    </script>

  </body>
</html>
</Layout>

